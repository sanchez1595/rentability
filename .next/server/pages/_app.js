(()=>{var e={};e.id=888,e.ids=[888],e.modules={656:(e,a,o)=>{"use strict";o.d(a,{w:()=>h,q:()=>g});var t=o(997),r=o(689);let i=(0,o(885).createClient)("https://lkpiyhdyiipgwyeojvep.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxrcGl5aGR5aWlwZ3d5ZW9qdmVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3MjU0NDcsImV4cCI6MjA2NjMwMTQ0N30.VUvm81C7f0noSmQ_6vWbTgQvyY6yL5d-39QcMUJqIYc"),s=e=>({id:e.id,nombre:e.nombre,categoria:e.categoria,costoCompra:e.costo_compra.toString(),gastosFijos:e.gastos_fijos.toString(),margenDeseado:e.margen_deseado.toString(),precioVenta:e.precio_venta.toString(),utilidad:e.utilidad.toString(),stock:e.stock.toString(),ventasUltimos30Dias:e.ventas_ultimos_30_dias.toString(),precioCompetencia:e.precio_competencia.toString(),fechaUltimaVenta:e.fecha_ultima_venta||"",rotacion:e.rotacion}),n=e=>({nombre:e.nombre,categoria:e.categoria,costo_compra:parseFloat(e.costoCompra)||0,gastos_fijos:parseFloat(e.gastosFijos)||0,margen_deseado:parseFloat(e.margenDeseado)||30,precio_venta:parseFloat(e.precioVenta)||0,utilidad:parseFloat(e.utilidad)||0,stock:parseInt(e.stock)||0,ventas_ultimos_30_dias:parseInt(e.ventasUltimos30Dias)||0,precio_competencia:parseFloat(e.precioCompetencia)||0,fecha_ultima_venta:e.fechaUltimaVenta||null,rotacion:e.rotacion}),c=e=>({id:e.id,productoId:e.producto_id,productoNombre:e.producto_nombre,cantidad:e.cantidad,precioVenta:e.precio_venta,costoUnitario:e.costo_unitario,fecha:e.fecha,cliente:e.cliente,metodoPago:e.metodo_pago,utilidadTotal:e.utilidad_total,ingresoTotal:e.ingreso_total}),l=e=>({producto_id:e.productoId,producto_nombre:e.productoNombre,cantidad:e.cantidad,precio_venta:e.precioVenta,costo_unitario:e.costoUnitario,fecha:e.fecha,cliente:e.cliente,metodo_pago:e.metodoPago,utilidad_total:e.utilidadTotal,ingreso_total:e.ingresoTotal}),d={async obtenerTodos(){let{data:e,error:a}=await i.from("productos").select("*").order("created_at",{ascending:!1});if(a)throw a;return(e||[]).map(s)},async crear(e){let a=n({...e,id:""}),{data:o,error:t}=await i.from("productos").insert([a]).select().single();if(t)throw t;return s(o)},async actualizar(e,a){let o={};void 0!==a.nombre&&(o.nombre=a.nombre),void 0!==a.categoria&&(o.categoria=a.categoria),void 0!==a.costoCompra&&(o.costo_compra=parseFloat(a.costoCompra)||0),void 0!==a.gastosFijos&&(o.gastos_fijos=parseFloat(a.gastosFijos)||0),void 0!==a.margenDeseado&&(o.margen_deseado=parseFloat(a.margenDeseado)||30),void 0!==a.precioVenta&&(o.precio_venta=parseFloat(a.precioVenta)||0),void 0!==a.utilidad&&(o.utilidad=parseFloat(a.utilidad)||0),void 0!==a.stock&&(o.stock=parseInt(a.stock)||0),void 0!==a.ventasUltimos30Dias&&(o.ventas_ultimos_30_dias=parseInt(a.ventasUltimos30Dias)||0),void 0!==a.precioCompetencia&&(o.precio_competencia=parseFloat(a.precioCompetencia)||0),void 0!==a.fechaUltimaVenta&&(o.fecha_ultima_venta=a.fechaUltimaVenta||null),void 0!==a.rotacion&&(o.rotacion=a.rotacion);let{data:t,error:r}=await i.from("productos").update(o).eq("id",e).select().single();if(r)throw r;return s(t)},async eliminar(e){let{error:a}=await i.from("productos").delete().eq("id",e);if(a)throw a}},m={async obtenerTodas(){let{data:e,error:a}=await i.from("ventas").select("*").order("fecha",{ascending:!1});if(a)throw a;return(e||[]).map(c)},async crear(e){let a=l(e),{data:o,error:t}=await i.from("ventas").insert([a]).select().single();if(t)throw t;return c(o)},async eliminar(e){let{error:a}=await i.from("ventas").delete().eq("id",e);if(a)throw a}},u={async obtener(){let{data:e,error:a}=await i.from("configuracion").select("*");if(a)throw a;let o={porcentajes:{},costosFijos:{},herramientas:{},ventasEstimadas:100};return(e||[]).forEach(e=>{"porcentaje"===e.tipo?o.porcentajes[e.clave]=e.valor:"costo_fijo"===e.tipo?o.costosFijos[e.clave]=e.valor:"herramienta"===e.tipo?o.herramientas[e.clave]=e.valor:"general"===e.tipo&&"ventas_estimadas"===e.clave&&(o.ventasEstimadas=e.valor)}),o},async actualizar(e,a,o){let{error:t}=await i.from("configuracion").upsert([{tipo:e,clave:a,valor:o}],{onConflict:"tipo,clave"});if(t)throw t},async eliminar(e,a){let{error:o}=await i.from("configuracion").delete().eq("tipo",e).eq("clave",a);if(o)throw o}},p={async obtener(){let{data:e,error:a}=await i.from("metas").select("*");if(a)throw a;let o={ventasMensuales:2e6,unidadesMensuales:200,margenPromedio:35,rotacionInventario:12};return(e||[]).forEach(e=>{switch(e.clave){case"ventas_mensuales":o.ventasMensuales=e.valor;break;case"unidades_mensuales":o.unidadesMensuales=e.valor;break;case"margen_promedio":o.margenPromedio=e.valor;break;case"rotacion_inventario":o.rotacionInventario=e.valor}}),o},async actualizar(e,a){let{error:o}=await i.from("metas").upsert([{clave:e,valor:a}],{onConflict:"clave"});if(o)throw o}},v={async obtener(){let{data:e,error:a}=await i.from("alertas").select("*");if(a)throw a;let o={margenMinimo:20,stockMinimo:5,diasSinVenta:30,diferenciaPrecioCompetencia:15};return(e||[]).forEach(e=>{switch(e.clave){case"margen_minimo":o.margenMinimo=e.valor;break;case"stock_minimo":o.stockMinimo=e.valor;break;case"dias_sin_venta":o.diasSinVenta=e.valor;break;case"diferencia_precio_competencia":o.diferenciaPrecioCompetencia=e.valor}}),o},async actualizar(e,a){let{error:o}=await i.from("alertas").upsert([{clave:e,valor:a}],{onConflict:"clave"});if(o)throw o}},f=(0,r.createContext)(void 0),g=()=>{let e=(0,r.useContext)(f);if(!e)throw Error("useApp debe ser usado dentro de AppProvider");return e},h=({children:e})=>{let[a,o]=(0,r.useState)([]),[i,s]=(0,r.useState)([]),[n,c]=(0,r.useState)({porcentajes:{contabilidad:2,mercadeo:5,ventas:15,salarios:10,compras:2,extras:5},costosFijos:{arriendo:1e6,energia:2e5,gas:5e4,aseo:8e5,internet:2e5,agua:2e5,servidores:11e4},herramientas:{figma:51600,chatgpt:86e3,correos:51600,servidor:1e5,dominio:12e4},ventasEstimadas:100}),[l,g]=(0,r.useState)({ventasMensuales:2e6,unidadesMensuales:200,margenPromedio:35,rotacionInventario:12}),[h,_]=(0,r.useState)({margenMinimo:20,stockMinimo:5,diasSinVenta:30,diferenciaPrecioCompetencia:15}),[w,y]=(0,r.useState)(!0),[j,b]=(0,r.useState)(null),E=async()=>{try{y(!0),b(null);let[e,a,t,r,i]=await Promise.all([d.obtenerTodos(),m.obtenerTodas(),u.obtener(),p.obtener(),v.obtener()]);o(e),s(a),c(t),g(r),_(i)}catch(e){console.error("Error cargando datos:",e),b("Error al cargar los datos. Por favor, recarga la p\xe1gina.")}finally{y(!1)}};(0,r.useEffect)(()=>{E()},[]);let I=async e=>{try{let a=await d.crear(e);o(e=>[a,...e])}catch(e){throw console.error("Error agregando producto:",e),Error("No se pudo agregar el producto")}},F=async(e,a)=>{try{let t=await d.actualizar(e,a);o(a=>a.map(a=>a.id===e?t:a))}catch(e){throw console.error("Error actualizando producto:",e),Error("No se pudo actualizar el producto")}},k=async e=>{try{await d.eliminar(e),o(a=>a.filter(a=>a.id!==e))}catch(e){throw console.error("Error eliminando producto:",e),Error("No se pudo eliminar el producto")}},C=async e=>{try{let o=await m.crear(e);s(e=>[o,...e]);let t=a.find(a=>a.id===e.productoId);if(t){let a=parseInt(t.stock)-e.cantidad;await F(e.productoId,{stock:a.toString(),fechaUltimaVenta:e.fecha})}}catch(e){throw console.error("Error registrando venta:",e),Error("No se pudo registrar la venta")}},S=async e=>{try{await m.eliminar(e),s(a=>a.filter(a=>a.id!==e))}catch(e){throw console.error("Error eliminando venta:",e),Error("No se pudo eliminar la venta")}},M=async(e,a,o)=>{try{await u.actualizar(e,a,o),c(t=>{let r={...t};return"porcentaje"===e?r.porcentajes={...t.porcentajes,[a]:o}:"costo_fijo"===e?r.costosFijos={...t.costosFijos,[a]:o}:"herramienta"===e?r.herramientas={...t.herramientas,[a]:o}:"general"===e&&"ventas_estimadas"===a&&(r.ventasEstimadas=o),r})}catch(e){throw console.error("Error actualizando configuraci\xf3n:",e),Error("No se pudo actualizar la configuraci\xf3n")}},z=async(e,a)=>{try{await u.eliminar(e,a),c(o=>{let t={...o};if("porcentaje"===e){let e={...o.porcentajes};delete e[a],t.porcentajes=e}else if("costo_fijo"===e){let e={...o.costosFijos};delete e[a],t.costosFijos=e}else if("herramienta"===e){let e={...o.herramientas};delete e[a],t.herramientas=e}return t})}catch(e){throw console.error("Error eliminando configuraci\xf3n:",e),Error("No se pudo eliminar la configuraci\xf3n")}},V=async(e,a)=>{try{await p.actualizar(e,a),g(o=>({...o,["ventas_mensuales"===e?"ventasMensuales":"unidades_mensuales"===e?"unidadesMensuales":"margen_promedio"===e?"margenPromedio":"rotacionInventario"]:a}))}catch(e){throw console.error("Error actualizando meta:",e),Error("No se pudo actualizar la meta")}},N=async(e,a)=>{try{await v.actualizar(e,a),_(o=>({...o,["margen_minimo"===e?"margenMinimo":"stock_minimo"===e?"stockMinimo":"dias_sin_venta"===e?"diasSinVenta":"diferenciaPrecioCompetencia"]:a}))}catch(e){throw console.error("Error actualizando alerta:",e),Error("No se pudo actualizar la alerta")}};return t.jsx(f.Provider,{value:{productos:a,ventas:i,configuracion:n,metas:l,alertas:h,loading:w,error:j,agregarProducto:I,actualizarProducto:F,eliminarProducto:k,registrarVenta:C,eliminarVenta:S,actualizarConfiguracion:M,eliminarConfiguracion:z,actualizarMeta:V,actualizarAlerta:N,recargarDatos:E},children:e})}},814:(e,a,o)=>{"use strict";o.r(a),o.d(a,{default:()=>i});var t=o(997);o(764);var r=o(656);function i({Component:e,pageProps:a}){return t.jsx(r.w,{children:t.jsx(e,{...a})})}},764:()=>{},885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},689:e=>{"use strict";e.exports=require("react")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")}};var a=require("../webpack-runtime.js");a.C(e);var o=a(a.s=814);module.exports=o})();